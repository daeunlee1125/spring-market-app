<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.shoply.mapper.SiteInfoMapper">


    <select id="selectRecentOne" resultType="kr.co.shoply.dto.SiteInfoDTO">
        SELECT * FROM Site_Info
        where s_no=#{s_no}
    </select>
    
    <update id="modifyTitles">
        UPDATE site_info SET s_title=#{s_title}, s_subtitle=#{s_subtitle}
        WHERE s_no=#{s_no}
    </update>

    <update id="modifyLogo1">
        UPDATE Site_info SET s_logo1=#{s_logo1}
        WHERE s_no=#{s_no}
    </update>

    <update id="modifyLogo2">
        UPDATE Site_info SET s_logo2=#{s_logo2}
        WHERE s_no=#{s_no}
    </update>

    <update id="modifyLogo3">
        UPDATE Site_info SET s_logo3=#{s_logo3}
        WHERE s_no=#{s_no}
    </update>

    <update id="modifyFooters">
        UPDATE site_info SET s_corp_name=#{s_corp_name}, s_ceo=#{s_ceo}, s_reg_hp=#{s_reg_hp}, s_tel_reg=#{s_tel_reg}, s_addr1=#{s_addr1}, s_addr2=#{s_addr2}
        WHERE s_no=#{s_no}
    </update>

    <update id="modifyCsInfos">
        UPDATE site_info SET s_cs_hp=#{s_cs_hp}, s_cs_time=#{s_cs_time}, s_cs_email=#{s_cs_email}, s_cs_hp2=#{s_cs_hp2}
        WHERE s_no=#{s_no}
    </update>

    <update id="modifyCopy">
        UPDATE Site_info SET s_copy=#{s_copy}
        WHERE s_no=#{s_no}
    </update>

    <select id="chartSelect" resultType="kr.co.shoply.dto.Chart1DTO">
        SELECT TO_CHAR(d.dt, 'MM-DD') AS "ch_date",
        NVL(COUNT(o.ord_date), 0) AS "order_cnt",
        NVL(SUM(CASE WHEN o.ord_stat = '2' THEN 1 ELSE 0 END), 0) AS "pay_cnt",
        NVL(SUM(CASE WHEN o.ord_stat = '3' THEN 1 ELSE 0 END), 0) AS "cancel_cnt"
        FROM (
        SELECT TRUNC(SYSDATE) - LEVEL + 1 AS dt
        FROM dual CONNECT BY LEVEL &lt;= 5
        ) d
        LEFT JOIN "order" o ON TRUNC(o.ord_date) = d.dt
        GROUP BY d.dt
        ORDER BY d.dt
    </select>

    <select id="selectSiteInfo3" resultType="kr.co.shoply.dto.SiteInfoDTO">
        SELECT *
        FROM SITE_INFO
    </select>

</mapper>