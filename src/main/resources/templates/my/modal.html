<!-- modal.html -->
<!-- 주문 상세 모달 -->
<div id="orderDetailPopup" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h4>주문상세</h4>
            <span class="close-btn" onclick="closeModal('orderDetailPopup')">&times;</span>
        </div>
        <div class="order-info">
            <h5>주문정보</h5>
            <p>주문번호: <span id="orderDetailNo">-</span></p>
        </div>
    </div>
</div>

<!-- 판매자 정보 모달 -->
<div id="sellerInfoPopup" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h4>판매자 정보</h4>
            <span class="close-btn" onclick="closeModal('sellerInfoPopup')">&times;</span>
        </div>
        <table class="info-table">
            <tbody>
            <tr>
                <td class="label" style="width: 150px;">상호</td>
                <td>(주) 상호명</td>
            </tr>
            <tr>
                <td class="label">대표자</td>
                <td>홍길동</td>
            </tr>
            </tbody>
        </table>
        <div style="text-align: right; margin-top: 20px;">
            <button onclick="openModal('qnaPopup'); closeModal('sellerInfoPopup');">문의하기</button>
        </div>
    </div>
</div>

<!-- 문의하기 모달 -->
<div id="qnaPopup" class="modal">
    <div class="modal-content" style="width: 500px;">
        <div class="modal-header">
            <h4>문의하기</h4>
            <span class="close-btn" onclick="closeModal('qnaPopup')">&times;</span>
        </div>
        <form id="qnaForm">
            <table class="info-table">
                <tbody>
                <tr>
                    <td class="label">문의유형</td>
                    <td>
                        <input type="radio" name="qna_type" value="상품"> 상품
                        <input type="radio" name="qna_type" value="배송"> 배송
                        <input type="radio" name="qna_type" value="기타"> 기타
                    </td>
                </tr>
                <tr>
                    <td class="label">제목</td>
                    <td><input type="text" name="title" style="width: 95%;"></td>
                </tr>
                <tr>
                    <td class="label">내용</td>
                    <td><textarea name="content" style="width: 95%; height: 150px;"></textarea></td>
                </tr>
                </tbody>
            </table>
            <div style="text-align: right; margin-top: 20px;">
                <button type="submit">등록하기</button>
                <button type="button" onclick="closeModal('qnaPopup')">취소</button>
            </div>
        </form>
    </div>
</div>

<!-- 구매확정 모달 -->
<div id="confirmModal" class="modal">
    <div class="modal-content" style="width: 400px; text-align: center;">
        <div class="modal-header">
            <h4>구매확정</h4>
            <span class="close-btn" onclick="closeModal('confirmModal')">&times;</span>
        </div>
        <p>상품을 받으셨나요?</p>
        <p>상품을 받으신 분만 구매확정을 해주세요.</p>
        <div style="margin-top: 20px;">
            <button id="confirmOrderBtn" style="padding: 8px 15px; background-color: #946ccf; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 5px;">확인</button>
            <button onclick="closeModal('confirmModal')" style="padding: 8px 15px; background-color: #ccc; color: #333; border: none; border-radius: 5px; cursor: pointer;">취소</button>
        </div>
    </div>
</div>

<!-- 리뷰 작성 모달 -->
<div id="reviewModal" class="modal">
    <div class="modal-content" style="width: 500px;">
        <div class="modal-header">
            <h4>상품평 작성하기</h4>
            <span class="close-btn" onclick="closeModal('reviewModal')">&times;</span>
        </div>
        <form id="reviewForm">
            <input type="hidden" name="prod_no" id="review_prod_no">
            <table class="info-table">
                <tbody>
                <tr>
                    <td class="label">상품명</td>
                    <td><p class="product-name-display">상품명</p></td>
                </tr>
                <tr>
                    <td class="label">만족도</td>
                    <td>
                        <div class="rating-container">
                            <input type="radio" name="rating" id="star5" value="5">
                            <label for="star5">★</label>
                            <input type="radio" name="rating" id="star4" value="4">
                            <label for="star4">★</label>
                            <input type="radio" name="rating" id="star3" value="3" checked>
                            <label for="star3">★</label>
                            <input type="radio" name="rating" id="star2" value="2">
                            <label for="star2">★</label>
                            <input type="radio" name="rating" id="star1" value="1">
                            <label for="star1">★</label>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="label">내용</td>
                    <td>
                        <textarea name="content" id="review_content" style="width: 95%; height: 100px;" placeholder="최소 10자 이상"></textarea>
                    </td>
                </tr>
                <tr>
                    <td class="label">사진</td>
                    <td>
                        <input type="file" name="file1" accept="image/*"><br>
                        <input type="file" name="file2" accept="image/*"><br>
                        <input type="file" name="file3" accept="image/*">
                    </td>
                </tr>
                </tbody>
            </table>
            <div style="text-align: right; margin-top: 20px;">
                <button type="submit">작성완료</button>
                <button type="button" onclick="closeModal('reviewModal')">취소</button>
            </div>
        </form>
    </div>
</div>

<!-- 반품/교환 모달 -->
<div id="returnModal" class="modal">
    <div class="modal-content" style="width: 600px;">
        <div class="modal-header">
            <h4>반품신청</h4>
            <span class="close-btn" onclick="closeModal('returnModal')">&times;</span>
        </div>
        <p>반품 신청 내용</p>
        <div style="text-align: right; margin-top: 20px;">
            <button onclick="closeModal('returnModal')">닫기</button>
        </div>
    </div>
</div>

<div id="exchangeModal" class="modal">
    <div class="modal-content" style="width: 600px;">
        <div class="modal-header">
            <h4>교환신청</h4>
            <span class="close-btn" onclick="closeModal('exchangeModal')">&times;</span>
        </div>
        <p>교환 신청 내용</p>
        <div style="text-align: right; margin-top: 20px;">
            <button onclick="closeModal('exchangeModal')">닫기</button>
        </div>
    </div>
</div>

<!-- 비밀번호 변경 모달 -->
<div id="passwordModal" class="modal">
    <div class="modal-content" style="width: 400px;">
        <div class="modal-header">
            <h4>비밀번호 변경</h4>
            <span class="close-btn" onclick="closeModal('passwordModal')">&times;</span>
        </div>
        <form id="passwordForm">
            <table class="info-table">
                <tbody>
                <tr>
                    <td class="label" style="width: 120px;">현재 비밀번호</td>
                    <td>
                        <input type="password" id="currentPassword" style="width: 95%; padding: 8px;">
                    </td>
                </tr>
                <tr>
                    <td class="label">새 비밀번호</td>
                    <td>
                        <input type="password" id="newPassword" style="width: 95%; padding: 8px;">
                    </td>
                </tr>
                <tr>
                    <td class="label">비밀번호 확인</td>
                    <td>
                        <input type="password" id="confirmPassword" style="width: 95%; padding: 8px;">
                    </td>
                </tr>
                </tbody>
            </table>
            <div style="text-align: right; margin-top: 20px;">
                <button type="submit" style="padding: 8px 15px; background-color: #946ccf; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 5px;">변경하기</button>
                <button type="button" onclick="closeModal('passwordModal')" style="padding: 8px 15px; background-color: #ccc; color: #333; border: none; border-radius: 5px; cursor: pointer;">취소</button>
            </div>
        </form>
    </div>
</div>

<!-- 반품 모달 -->
<div id="returnModal" class="modal">
    <div class="modal-content" style="width: 600px;">
        <div class="modal-header">
            <h4>반품신청</h4>
            <span class="close-btn" onclick="closeModal('returnModal')">&times;</span>
        </div>
        <form id="returnForm">
            <table class="info-table">
                <tbody>
                <tr>
                    <td class="label" style="width: 120px;">반품 사유</td>
                    <td>
                        <select name="reason" style="width: 95%; padding: 8px;">
                            <option value="">선택하세요</option>
                            <option value="단순변심">단순변심</option>
                            <option value="상품불량">상품불량</option>
                            <option value="배송지연">배송지연</option>
                            <option value="상품정보불일치">상품정보불일치</option>
                            <option value="기타">기타</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="label">상세 내용</td>
                    <td>
                        <textarea name="detail" style="width: 95%; height: 100px;" placeholder="반품 사유를 자세히 입력해주세요"></textarea>
                    </td>
                </tr>
                </tbody>
            </table>
            <div style="text-align: right; margin-top: 20px;">
                <button type="submit" style="padding: 8px 15px; background-color: #946ccf; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 5px;">신청하기</button>
                <button type="button" onclick="closeModal('returnModal')" style="padding: 8px 15px; background-color: #ccc; color: #333; border: none; border-radius: 5px; cursor: pointer;">취소</button>
            </div>
        </form>
    </div>
</div>

<!-- 교환 모달 -->
<div id="exchangeModal" class="modal">
    <div class="modal-content" style="width: 600px;">
        <div class="modal-header">
            <h4>교환신청</h4>
            <span class="close-btn" onclick="closeModal('exchangeModal')">&times;</span>
        </div>
        <form id="exchangeForm">
            <table class="info-table">
                <tbody>
                <tr>
                    <td class="label" style="width: 120px;">교환 사유</td>
                    <td>
                        <select name="reason" style="width: 95%; padding: 8px;">
                            <option value="">선택하세요</option>
                            <option value="사이즈/색상 변경">사이즈/색상 변경</option>
                            <option value="상품불량">상품불량</option>
                            <option value="오배송">오배송</option>
                            <option value="상품정보불일치">상품정보불일치</option>
                            <option value="기타">기타</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="label">상세 내용</td>
                    <td>
                        <textarea name="detail" style="width: 95%; height: 100px;" placeholder="교환 사유를 자세히 입력해주세요"></textarea>
                    </td>
                </tr>
                </tbody>
            </table>
            <div style="text-align: right; margin-top: 20px;">
                <button type="submit" style="padding: 8px 15px; background-color: #946ccf; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 5px;">신청하기</button>
                <button type="button" onclick="closeModal('exchangeModal')" style="padding: 8px 15px; background-color: #ccc; color: #333; border: none; border-radius: 5px; cursor: pointer;">취소</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 반품 신청 폼
        const returnForm = document.getElementById('returnForm');
        if (returnForm) {
            returnForm.addEventListener('submit', function(e) {
                e.preventDefault();

                const modal = document.getElementById('returnModal');
                const itemNo = modal.dataset.itemNo;
                const reason = returnForm.querySelector('select[name="reason"]').value;
                const detail = returnForm.querySelector('textarea[name="detail"]').value.trim();

                if (!reason) {
                    alert('반품 사유를 선택해주세요.');
                    return;
                }

                if (!detail) {
                    alert('상세 내용을 입력해주세요.');
                    return;
                }

                const fullReason = reason + (detail ? ' - ' + detail : '');

                fetch(`/shoply/my/order/return?item_no=${itemNo}&reason=${encodeURIComponent(fullReason)}`, {
                    method: 'POST'
                })
                    .then(res => res.text())
                    .then(data => {
                        if (data === 'success') {
                            alert('반품 신청이 완료되었습니다.');
                            closeModal('returnModal');
                            returnForm.reset();
                            location.reload();
                        } else {
                            alert('반품 신청 실패: ' + data);
                        }
                    })
                    .catch(err => {
                        console.error(err);
                        alert('오류가 발생했습니다.');
                    });
            });
        }

        // 교환 신청 폼
        const exchangeForm = document.getElementById('exchangeForm');
        if (exchangeForm) {
            exchangeForm.addEventListener('submit', function(e) {
                e.preventDefault();

                const modal = document.getElementById('exchangeModal');
                const itemNo = modal.dataset.itemNo;
                const reason = exchangeForm.querySelector('select[name="reason"]').value;
                const detail = exchangeForm.querySelector('textarea[name="detail"]').value.trim();

                if (!reason) {
                    alert('교환 사유를 선택해주세요.');
                    return;
                }

                if (!detail) {
                    alert('상세 내용을 입력해주세요.');
                    return;
                }

                const fullReason = reason + (detail ? ' - ' + detail : '');

                fetch(`/shoply/my/order/exchange?item_no=${itemNo}&reason=${encodeURIComponent(fullReason)}`, {
                    method: 'POST'
                })
                    .then(res => res.text())
                    .then(data => {
                        if (data === 'success') {
                            alert('교환 신청이 완료되었습니다.');
                            closeModal('exchangeModal');
                            exchangeForm.reset();
                            location.reload();
                        } else {
                            alert('교환 신청 실패: ' + data);
                        }
                    })
                    .catch(err => {
                        console.error(err);
                        alert('오류가 발생했습니다.');
                    });
            });
        }
    });
</script>
<script>
    // 비밀번호 변경 폼 제출
    document.addEventListener('DOMContentLoaded', function() {
        const passwordForm = document.getElementById('passwordForm');
        if (passwordForm) {
            passwordForm.addEventListener('submit', function(e) {
                e.preventDefault();

                const currentPassword = document.getElementById('currentPassword').value.trim();
                const newPassword = document.getElementById('newPassword').value.trim();
                const confirmPassword = document.getElementById('confirmPassword').value.trim();

                if (!currentPassword) {
                    alert('현재 비밀번호를 입력해주세요.');
                    return;
                }

                if (!newPassword) {
                    alert('새 비밀번호를 입력해주세요.');
                    return;
                }

                if (newPassword.length < 6) {
                    alert('비밀번호는 최소 6자 이상이어야 합니다.');
                    return;
                }

                if (newPassword !== confirmPassword) {
                    alert('비밀번호가 일치하지 않습니다.');
                    return;
                }

                fetch('/shoply/my/info/changePassword', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        currentPassword: currentPassword,
                        newPassword: newPassword
                    })
                })
                    .then(res => res.text())
                    .then(data => {
                        if (data === 'success') {
                            alert('비밀번호가 변경되었습니다.');
                            closeModal('passwordModal');
                            passwordForm.reset();
                        } else {
                            alert('비밀번호 변경 실패: ' + data);
                        }
                    })
                    .catch(err => {
                        console.error(err);
                        alert('오류가 발생했습니다.');
                    });
            });
        }
    });


</script>