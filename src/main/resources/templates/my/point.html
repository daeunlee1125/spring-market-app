<!-- point.html -->
<div th:replace="~{my/_head.html}"></div>

<main class="container">
    <div class="sidebar">
        <ul>
            <li><a th:href="@{/my/home}">마이페이지 홈</a></li>
            <li><a th:href="@{/my/order}">전체주문내역</a></li>
            <li><a th:href="@{/my/point}" class="active">포인트내역</a></li>
            <li><a th:href="@{/my/coupon}">쿠폰</a></li>
            <li><a th:href="@{/my/review}">나의리뷰</a></li>
            <li><a th:href="@{/my/qna}">문의하기</a></li>
            <li><a th:href="@{/my/info}">나의설정</a></li>
        </ul>
    </div>
    <div class="content">

        <div class="main-content-header">
            <h2>나의 쇼핑 정보</h2>
            <div class="info-summary">
                <div class="info-item">
                    <div class="count" th:text="${orderCount}">2</div>
                    <div>주문</div>
                </div>
                <div class="info-item">
                    <div class="count" th:text="${couponCount}">1</div>
                    <div>쿠폰</div>
                </div>
                <div class="info-item">
                    <div class="count" th:text="${#numbers.formatInteger(pointTotal, 0, 'COMMA')}">1,000</div>
                    <div>포인트</div>
                </div>
                <div class="info-item">
                    <div class="count" th:text="${qnaCount}">1</div>
                    <div>문의</div>
                </div>
            </div>
        </div>

        <div class="banner">
            810 x 86 배너 광고
        </div>

        <div style="margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 8px;">
            <h3 style="margin-top: 0;">기간별 조회</h3>
            <form id="periodForm" method="get" th:action="@{/my/point}" style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">

                <!-- 빠른 선택 버튼 -->
                <div style="display: flex; gap: 8px;">
                    <button type="button" class="period-btn" data-period="1day" style="padding: 8px 15px; border: 1px solid #ddd; background: #fff; border-radius: 4px; cursor: pointer;">1일</button>
                    <button type="button" class="period-btn" data-period="1week" style="padding: 8px 15px; border: 1px solid #ddd; background: #fff; border-radius: 4px; cursor: pointer;">1주일</button>
                    <button type="button" class="period-btn" data-period="1month" style="padding: 8px 15px; border: 1px solid #ddd; background: #fff; border-radius: 4px; cursor: pointer;">1개월</button>
                </div>

                <!-- 개월 선택 -->
                <div>
                    <select id="monthSelect" name="month" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">개월 선택</option>
                        <option value="3">3개월</option>
                        <option value="6">6개월</option>
                        <option value="12">12개월</option>
                    </select>
                </div>

                <!-- 커스텀 기간 (년월일) -->
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="font-weight: bold;">기간:</span>
                    <input type="date" id="startMonth" name="startMonth" placeholder="시작 날짜" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <span>~</span>
                    <input type="date" id="endMonth" name="endMonth" placeholder="종료 날짜" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>

                <!-- 숨겨진 기간 값 -->
                <input type="hidden" id="periodType" name="periodType" value="">
                <input type="hidden" id="period" name="period" value="">

                <!-- 조회 버튼 -->
                <button type="submit" style="padding: 8px 20px; background: #946ccf; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">조회</button>

                <!-- 초기화 버튼 -->
                <button type="button" id="resetBtn" style="padding: 8px 20px; background: #ddd; color: #333; border: none; border-radius: 4px; cursor: pointer;">초기화</button>
            </form>
        </div>

        <div class="point-summary">
            <p>총 적립 포인트 : <span th:text="${#numbers.formatInteger(pointTotal, 0, 'COMMA')}">1,000</span> P</p>
        </div>

        <table class="point-table">
            <thead>
            <tr>
                <th>날짜</th>
                <th>구분</th>
                <th>주문번호</th>
                <th>적립금액</th>
                <th>비고</th>
                <th>유효기간</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="point : ${pointPage.content}">
                <td th:text="${point.p_date}">2022-12-13</td>
                <td>
                    <span th:if="${point.p_type == 1}">적립</span>
                    <span th:if="${point.p_type == 2}">사용</span>
                    <span th:unless="${point.p_type == 1 or point.p_type == 2}">기타</span>
                </td>
                <td th:text="${point.ord_no != null ? point.ord_no : '-'}">111111</td>
                <td th:text="${#numbers.formatInteger(point.p_point, 0, 'COMMA')}">340</td>
                <td th:text="${point.p_info}">상품구매확정</td>
                <td th:text="${point.p_exp_date}">2024-12-10</td>
            </tr>
            <tr th:if="${#lists.isEmpty(pointPage.content)}">
                <td colspan="6" style="text-align: center;">포인트 내역이 없습니다.</td>
            </tr>
            </tbody>
        </table>

        <div class="info-section">
            <h3>포인트 안내</h3>
            <ul class="info-text">
                <li>적립된 포인트는 현금처럼 사용하실 수 있습니다.</li>
                <li>포인트는 주문 금액의 10%가 자동으로 적립됩니다. (예: 10,000원 구매 시 1,000P 적립)</li>
                <li>구매 확정 후 7일 이내에 포인트가 적립됩니다.</li>
                <li>유효 기간이 지난 포인트는 자동으로 소멸됩니다.</li>
            </ul>
        </div>

        <!-- 페이지네이션 -->
        <div style="text-align: center; margin: 30px 0; padding: 20px; background: #f9f9f9; border-radius: 8px;">
            <!-- 첫 페이지 -->
            <a th:if="${pointPage.number > 0}"
               th:href="@{/my/point(page=0)}"
               style="display: inline-block; width: 36px; height: 36px; line-height: 36px;
                      border: 1px solid #ddd; border-radius: 6px; margin: 0 2px;
                      background: #fff; color: #946ccf; text-decoration: none; font-weight: bold;">«</a>
            <span th:unless="${pointPage.number > 0}"
                  style="display: inline-block; width: 36px; height: 36px; line-height: 36px;
                        border: 1px solid #e0e0e0; border-radius: 6px; margin: 0 2px;
                        background: #f5f5f5; color: #ccc; font-weight: bold;">«</span>

            <!-- 이전 페이지 -->
            <a th:if="${pointPage.hasPrevious()}"
               th:href="@{/my/point(page=${pointPage.number - 1})}"
               style="display: inline-block; width: 36px; height: 36px; line-height: 36px;
                      border: 1px solid #ddd; border-radius: 6px; margin: 0 2px;
                      background: #fff; color: #946ccf; text-decoration: none; font-weight: bold;">‹</a>
            <span th:unless="${pointPage.hasPrevious()}"
                  style="display: inline-block; width: 36px; height: 36px; line-height: 36px;
                        border: 1px solid #e0e0e0; border-radius: 6px; margin: 0 2px;
                        background: #f5f5f5; color: #ccc; font-weight: bold;">‹</span>

            <!-- 페이지 번호 -->
            <th:block th:each="i : ${#numbers.sequence(0, pointPage.totalPages - 1)}">
                <a th:if="${i != pointPage.number}"
                   th:href="@{/my/point(page=${i})}"
                   th:text="${i + 1}"
                   style="display: inline-block; width: 36px; height: 36px; line-height: 36px;
                          border: 1px solid #ddd; border-radius: 6px; margin: 0 2px;
                          background: #fff; color: #555; text-decoration: none; font-weight: 600;"></a>
                <span th:if="${i == pointPage.number}"
                      th:text="${i + 1}"
                      style="display: inline-block; width: 36px; height: 36px; line-height: 36px;
                            border: 1px solid #946ccf; border-radius: 6px; margin: 0 2px;
                            background: linear-gradient(135deg, #a86cc1, #946ccf); color: #fff;
                            font-weight: 700;"></span>
            </th:block>

            <!-- 다음 페이지 -->
            <a th:if="${pointPage.hasNext()}"
               th:href="@{/my/point(page=${pointPage.number + 1})}"
               style="display: inline-block; width: 36px; height: 36px; line-height: 36px;
                      border: 1px solid #ddd; border-radius: 6px; margin: 0 2px;
                      background: #fff; color: #946ccf; text-decoration: none; font-weight: bold;">›</a>
            <span th:unless="${pointPage.hasNext()}"
                  style="display: inline-block; width: 36px; height: 36px; line-height: 36px;
                        border: 1px solid #e0e0e0; border-radius: 6px; margin: 0 2px;
                        background: #f5f5f5; color: #ccc; font-weight: bold;">›</span>

            <!-- 마지막 페이지 -->
            <a th:if="${pointPage.number < pointPage.totalPages - 1}"
               th:href="@{/my/point(page=${pointPage.totalPages - 1})}"
               style="display: inline-block; width: 36px; height: 36px; line-height: 36px;
                      border: 1px solid #ddd; border-radius: 6px; margin: 0 2px;
                      background: #fff; color: #946ccf; text-decoration: none; font-weight: bold;">»</a>
            <span th:unless="${pointPage.number < pointPage.totalPages - 1}"
                  style="display: inline-block; width: 36px; height: 36px; line-height: 36px;
                        border: 1px solid #e0e0e0; border-radius: 6px; margin: 0 2px;
                        background: #f5f5f5; color: #ccc; font-weight: bold;">»</span>

            <div style="margin-top: 12px; font-size: 13px; color: #999;">
                <th:block th:text="${pointPage.number + 1} + ' / ' + ${pointPage.totalPages}"></th:block>
            </div>
        </div>
    </div>
</main>
<div th:replace="~{my/_tail.html}"></div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const periodBtns = document.querySelectorAll('.period-btn');
        const monthSelect = document.getElementById('monthSelect');
        const startMonth = document.getElementById('startMonth');
        const endMonth = document.getElementById('endMonth');
        const periodType = document.getElementById('periodType');
        const periodInput = document.getElementById('period');
        const resetBtn = document.getElementById('resetBtn');
        const periodForm = document.getElementById('periodForm');

        // 빠른 선택 버튼
        periodBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                periodBtns.forEach(b => b.style.background = '#fff');
                this.style.background = '#946ccf';
                this.style.color = '#fff';

                periodType.value = this.getAttribute('data-period');
                monthSelect.value = '';
                startMonth.value = '';
                endMonth.value = '';
                periodForm.submit();
            });
        });

        // 개월 선택
        monthSelect.addEventListener('change', function() {
            if(this.value) {
                periodBtns.forEach(b => b.style.background = '#fff');
                periodType.value = 'month';
                periodInput.value = this.value;
                startMonth.value = '';
                endMonth.value = '';
                periodForm.submit();
            }
        });

        // 커스텀 기간 (조회 버튼 클릭)
        periodForm.addEventListener('submit', function(e) {
            if(!periodType.value && !periodInput.value && !startMonth.value && !endMonth.value) {
                return true;
            }

            if(startMonth.value && endMonth.value) {
                periodType.value = 'custom';
                periodInput.value = '';
            }
        });

        // 초기화
        resetBtn.addEventListener('click', function() {
            periodBtns.forEach(b => b.style.background = '#fff');
            monthSelect.value = '';
            startMonth.value = '';
            endMonth.value = '';
            periodType.value = '';
            periodInput.value = '';
            window.location.href = '/shoply/my/point';
        });
    });
</script>