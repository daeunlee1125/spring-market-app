<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1조-[[${siteInfoDTO.s_title}]], [[${siteInfoDTO.s_subtitle}]]</title>

    <link rel="stylesheet" th:href="@{/css/_tamplateProduct.css}">
    <link rel="stylesheet" th:href="@{/css/product.css}"/>

    <!-- bxSlider -->
    <script th:src="@{https://code.jquery.com/jquery-3.6.0.min.js}"></script>
    <link rel="stylesheet" th:href="@{https://cdn.jsdelivr.net/bxslider/4.2.12/jquery.bxslider.css}">
    <script th:src="@{https://cdn.jsdelivr.net/bxslider/4.2.12/jquery.bxslider.min.js}"></script>
    <script th:src="@{https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js}"></script>
</head>

<body>

<header>
    <div class="top-bar-back">
        <div class="top-bar">오늘의 행운 룰렛 → 꽝 없는 선물파티 OPEN!</div>
    </div>

    <!-- 1번째 줄 -->
    <div class="top-header">

        <!-- 로고 -->
        <div class="header-left">
            <a th:href="@{/index}">
                <img th:src="@{${siteInfoDTO.s_logo1}}" alt="로고" class="logo">
            </a>
        </div>

        <!-- 검색창 -->
        <div class="header-center">
            <form th:action="@{/product/search}" method="get">
                <input type="text" name="keyword" placeholder="검색">
                <button type="submit">
                    <img th:src="@{/image/search.png}" alt="검색">
                </button>
            </form>
        </div>

        <!-- 아이콘 + 로그인 메뉴 -->
        <div class="header-right">
            <a th:href="@{/my/home}">
                <img th:src="@{/image/user.png}" alt="유저" class="icon">
            </a>
            <a th:href="@{/product/cart}">
                <img th:src="@{/image/cart.png}" alt="장바구니" class="icon" style="width: 30px;">
            </a>
            <span class="cart-count"
                  th:if="${cartCount != null && cartCount > 0}"
                  th:text="${cartCount}">0</span>
        </div>
    </div>

    <div class="bottom-header">
        <div class="header-left">
            <a href="#" id="categoryBtn"> 전체 카테고리</a>
            <a th:href="@{/index#hit-products}">히트상품</a>
            <a th:href="@{/index#recommended-products}">추천상품</a>
            <a th:href="@{/index#recent-products}">최신상품</a>
            <a th:href="@{/index#best-products}">인기상품</a>
            <a th:href="@{/index#discount-products}">할인상품</a>
        </div>

        <div class="header-right login-menu">
            <a th:if="${#authorization.expr('!isAuthenticated()')}" th:href="@{/member/login}">로그인</a><a th:if="${#authorization.expr('isAuthenticated()')}" th:href="@{/member/logout}">로그아웃</a>
            |
            <a th:if="${#authorization.expr('isAuthenticated()') && (#authentication.principal.member.mem_level == 7 || #authentication.principal.member.mem_level == 2)}" th:href="@{/admin/}">관리자 페이지</a>
            <a th:if="${#authorization.expr('isAuthenticated()') && #authentication.principal.member.mem_level == 1}">[[${#authentication.principal.member.mem_name}]]님</a>
            <a th:if="${#authorization.expr('!isAuthenticated()')}" th:href="@{/member/join}">회원가입</a>

            |
            <a th:href="@{/cs}">고객센터</a>
        </div>

    </div>

</header>



<div class="container">

    <!-- 베스트 상품 안 들어가는 창은 여기부터 저 아래 주석까지 삭제 하고 작업 -->
    <div class="left-space">
        <div class="inner">
            <h3>베스트 상품</h3>

            <!-- 첫 번째 상품 (가장 많이 팔린 1위) -->
            <div th:if="${#lists.size(sidebarBestProducts) > 0}" class="product-card" th:with="p=${sidebarBestProducts[0]}">
                <div class="img-box">
                    <img th:src="@{|${p.f_name}|}" alt="상품" class="prod-img">
                </div>
                <a th:href="@{/product/view/{cate2No}/{prodNo}(cate2No=${p.getCate2_no()}, prodNo=${p.getProd_no()})}" class="name" th:text="${p.prod_name}"></a>
                <div class="price-box">
                    <div class="price-top">
                        <span class="original" th:text="${#numbers.formatInteger(p.prod_price, 3, 'COMMA')} + '원'"></span>
                        <span class="discount" th:text="${p.prod_sale + '%'}"></span>
                    </div>
                    <div class="sale-cont">
                    <span class="sale"
                          th:text="${#numbers.formatInteger(p.prod_price - (p.prod_price * p.prod_sale / 100), 3, 'COMMA')} + '원'">0원</span>
                    </div>
                </div>
            </div>

            <!-- 나머지 상품 -->
            <ul class="product-list">
                <li class="product-item"
                    th:each="p, iterStat : ${sidebarBestProducts}"
                    th:if="${iterStat.index >= 1 and iterStat.index < 5}">
                    <div class="thumb">
                        <img th:src="@{|${p.f_name}|}" alt="상품" class="prod-img">
                    </div>
                    <div class="info">
                        <a th:href="@{/product/view/{cate2No}/{prodNo}(cate2No=${p.getCate2_no()}, prodNo=${p.getProd_no()})}" class="name" th:text="${p.prod_name}"></a>
                        <div class="price-box">
                            <div class="price-top2">
                                <span class="original" th:text="${#numbers.formatInteger(p.prod_price, 3, 'COMMA')} + '원'"></span>
                                <span class="discount" th:text="${p.prod_sale + '%'}"></span>
                            </div>
                            <div class="sale-cont">
                            <span class="sale"
                                  th:text="${#numbers.formatInteger(p.prod_price - (p.prod_price * p.prod_sale / 100), 3, 'COMMA')} + '원'">0원</span>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <!--  여기까지 베스트 상품 -->


    <div class="wrapper">

        <!-- 전체 카테고리 누르면 튀어나오는 메뉴창 -->
        <div id="categoryBox" class="category-box">
            <div class="main-menu">
                <li th:each="cate1, iterStat : ${cate1DTOList}"
                    th:data-target="|menu${iterStat.count}|"
                    th:class="${iterStat.index == 0} ? 'active' : ''"> <span th:text="${cate1.cate1_name}">패션의류</span>
                </li>
            </div>

            <div class="sub-menu">
                <ul th:each="cate1, iterStat : ${cate1DTOList}"
                    th:id="|menu${iterStat.count}|"
                    class="submenu-content"
                    th:style="${iterStat.index > 0} ? 'display:none;'">

                    <li th:each="cate2 : ${cate1.subCategories}">
                        <a th:href="@{/product/list/{cate2No}(cate2No=${cate2.cate2_no})}"
                           th:text="${cate2.cate2_name}">
                        </a>
                    </li>
                </ul>
            </div>
        </div>
